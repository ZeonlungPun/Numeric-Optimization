coordinate=[31.2006990000000,   121.195447000000
31.1999740000000,    121.302863000000
31.2487390000000,    121.345995000000
31.1737900000000,    121.128212000000
31.1610230000000,    121.111884000000
31.1522860000000,    121.187403000000
31.1651130000000,    121.110473000000
31.3111830000000,    121.545410000000
31.2569610000000,    121.473418000000
31.2618510000000,    121.544265000000
31.2644080000000,    121.412710000000
31.2800750000000,    121.434740000000
31.2330560000000,    121.372183000000
31.2372000000000,    121.402512000000
31.2820830000000,    121.538396000000
31.2116730000000,    121.389858000000
31.3179770000000,    121.553050000000
31.2645010000000,    121.355632000000
31.3125730000000,    121.472295000000
31.3521800000000,    121.437859000000
31.4014200000000,    121.464019000000
31.4050720000000,    121.509817000000
31.3203530000000,    121.474440000000
31.4829720000000,    121.332108000000
31.4111360000000,    121.353557000000
31.3571250000000,    121.507167000000
31.3613660000000,    121.392618000000
31.3162110000000,    121.405014000000
31.3333740000000,    121.462548000000
31.2942450000000,    121.311899000000
31.3978140000000,    121.281854000000
31.3040400000000,    121.174793000000
31.3306560000000,    121.271897000000
31.2535280000000,    121.312014000000
31.1189280000000,    121.430417000000
31.1656120000000,    121.457527000000
31.1659440000000,    121.399218000000
31.2781040000000,    121.695219000000
31.2491910000000,    121.683054000000
31.2665760000000,    121.584458000000
30.9059200000000,    121.629400000000
31.2151300000000,    121.653498000000
31.0331490000000,    121.585322000000
30.9320060000000,    121.569712000000
31.0516380000000,    121.597918000000
31.0331510000000,    121.194807000000
31.0534760000000,    121.458736000000
31.0886080000000,    121.376303000000
31.2080200000000,    121.547540000000
31.1606670000000,    121.512126000000
31.1796280000000,    121.523585000000
31.1344450000000,    121.510146000000
31.2121040000000,    121.370803000000
31.1752590000000,    121.286866000000
31.2503750000000,    121.241234000000
31.2682660000000,    121.494618000000
31.2859420000000,    121.355885000000
31.2765840000000,    121.388417000000
30.9391320000000,    121.458801000000
30.9257390000000,    121.518067000000
30.7270350000000,    121.359077000000
30.7310450000000,    121.339345000000
30.9261900000000,    121.445795000000
30.8990280000000,    121.179453000000
30.8373880000000,    121.186939000000
30.8782630000000,    121.559792000000
30.8592860000000,    121.342500000000
30.9284320000000,    121.472888000000
31.3121450000000,    121.477937000000
31.3489050000000,    121.479111000000
31.3568480000000,    121.360833000000
31.3349670000000,    121.503255000000
31.4027060000000,    121.275040000000
31.3738950000000,    121.240109000000
31.2904340000000,    121.317538000000
31.3840390000000,    121.153913000000
31.2801720000000,    121.303692000000
31.1152880000000,    121.422746000000
31.1802720000000,    121.421049000000
31.1431390000000,    121.433062000000
31.2014330000000,    121.434782000000
31.1460100000000,    121.362961000000
31.1907530000000,    121.372918000000
31.1471410000000,    121.402742000000
31.1864050000000,    121.457014000000
31.1834800000000,    121.434396000000
31.1259040000000,    121.423424000000
31.2780920000000,    121.597586000000
31.2648240000000,    121.566820000000
31.3353140000000,    121.581277000000
31.2804130000000,    121.593315000000
31.2718620000000,    121.593569000000
31.2811240000000 ,   121.616186000000
31.3466450000000,    121.592160000000
31.2837010000000,    121.595378000000
31.2694150000000,    121.592652000000
31.0477240000000,    121.783712000000
31.0307480000000,    121.655021000000
31.2011960000000,    121.634969000000
31.0623070000000,    121.774891000000
30.9123690000000,    121.655509000000
31.2660750000000,    121.685597000000
31.2366290000000,    121.732530000000
31.0185560000000,    121.437335000000
31.0551430000000,    121.408290000000
31.0524320000000,    121.415297000000
31.0948100000000,    121.271300000000
31.0396030000000,    121.193412000000
31.0652910000000,    121.420516000000
31.1526520000000,    121.314224000000
31.0687600000000,    121.242162000000
31.0954570000000,    121.351544000000
31.0930850000000,    121.421098000000
31.0241010000000,    121.208819000000
31.1561970000000,    121.580258000000
31.0925010000000,    121.520596000000
31.2174150000000,    121.538298000000
31.1467460000000,    121.497248000000
31.1613310000000,    121.543094000000
31.1848830000000,    121.480627000000
31.1178330000000,    121.583561000000
31.3763000000000,    121.471500000000];

NIND = 100;         %population size
MAXGEN = 3000;       % max iteration
Pc = 0.9;           % crossover p
Pm = 0.05;          % mutation p
GGAP = 0.9;         %generation gapï¼Œnext generation number= parent generation num*GGAP
N = size(coordinate,1);      % city num
%%innitilize popilation
Chrom = InitPop(NIND,N);


gen = 0;
figure;
hold on;
box on;
xlim([0,MAXGEN])
title('update process')
xlabel('iteration')
ylabel('curent optimal')

%current distnace
ObjV = PathLength(coordinate,Chrom);
preObjV = min(ObjV);

while gen<MAXGEN
    %%calculate fitness
    ObjV = PathLength(coordinate,Chrom);    
    line([gen - 1,gen],[preObjV,min(ObjV)]);
    pause(0.0001);
    preObjV = min(ObjV);
    FitnV = fitness(ObjV);
    %selection
    SelCh = Select(Chrom,FitnV,GGAP);
    %cross over
    SelCH = Recombin(SelCh,Pc);
    %mutation
    SelCh = Mutate(SelCh,Pm);
    %reverse
    SelCh = Reverse(SelCh,coordinate);
    %new population
    Chrom = Reins(Chrom,SelCh,ObjV);
    % update iteration
    gen = gen + 1;
end

%best solution
ObjV = PathLength(coordinate,Chrom); 
[minObjV,minInd] = min(ObjV);
best_path=Chrom(minInd(1),:);


for i=1:length(best_path)-1
    i1=best_path(i);
    i2=best_path(i+1);
    coor1=coordinate(i1,:);
    coor2=coordinate(i2,:);
    x1=coor1(1);
    y1=coor1(2);
    x2=coor2(1);
    y2=coor2(2);
    plot([x1,x2],[y1,y2]);
    hold on;
end
i1=best_path(1);
i2=best_path(end);
coor1=coordinate(i1,:);
coor2=coordinate(i2,:);
x1=coor1(1);
y1=coor1(2);
x2=coor2(1);
y2=coor2(2);
plot([x1,x2],[y1,y2]);

